# https://taskfile.dev

version: '3'

vars:
  VERSION: "1.2.12"
  GIT_COMMIT: {sh: git log -n 1 --format=%h}

tasks:

  depend:
    cmds:
      - go get -v -u

  prepare:
    cmds:
      - npm install -g less
      - lessc contrib\\main.less contrib\\main.css
      - xcopy /y /q contrib\\main.css static\\css\\main.css

  build:
    deps: [build_386, build_amd64]

  build_386:
    env:
      GOOS: "windows"
      GOARCH: "386"
      CGO_ENABLED: "1"
      CC: "gcc.exe"
      CXX: "g++.exe"
    cmds:
      - go build -o golden-windows-386.exe .

  build_amd64:
    env:
      GOOS: "windows"
      GOARCH: "amd64"
      CGO_ENABLED: "1"
      CC: "x86_64-w64-mingw32-gcc.exe"
      CXX: "x86_64-w64-mingw32-g++.exe"
    cmds:
      - go build -o golden-windows-amd64.exe .

  package:
    cmds:
      - echo "No package."
